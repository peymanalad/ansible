# Fail2Ban Jail Configuration
# Generated by Ansible

[DEFAULT]
# Ban settings
bantime = {{ fail2ban_bantime }}
findtime = 600
maxretry = {{ fail2ban_maxretry }}

# Action
banaction = ufw
banaction_allports = ufw

# Ignore IPs (add your trusted IPs)
ignoreip = 127.0.0.1/8 ::1

# Logging
loglevel = INFO
logtarget = /var/log/fail2ban.log

# Email notifications
#destemail = admin@example.com
#sender = fail2ban@{{ ansible_fqdn }}
#mta = sendmail
#action = %(action_mwl)s

[sshd]
enabled = true
port = {{ ssh_port }}
filter = sshd
logpath = /var/log/auth.log
maxretry = {{ fail2ban_maxretry }}
bantime = {{ fail2ban_bantime }}

# Aggressive bots - longer ban
[sshd-aggressive]
enabled = true
port = {{ ssh_port }}
filter = sshd
logpath = /var/log/auth.log
maxretry = 1
findtime = 86400
bantime = 604800

# Nginx - Too many 404s
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[nginx-botsearch]
enabled = true
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

# Bad bots
[nginx-badbots]
enabled = true
filter = nginx-badbots
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

# Rate limiting for web
[nginx-limit-req]
enabled = true
filter = nginx-limit-req
logpath = /var/log/nginx/error.log
maxretry = 10
findtime = 60
bantime = 7200
