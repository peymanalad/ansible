# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¦ PostgreSQL Installation and Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ Ù‡Ø¯Ù Ø§ÛŒÙ† Playbook:
#    Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ PostgreSQL Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Production-ready
#
# âœ… Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯:
#    1. Ù†ØµØ¨ PostgreSQL Ø§Ø² repository Ø±Ø³Ù…ÛŒ
#    2. ØªÙ†Ø¸ÛŒÙ… postgresql.conf Ø¨Ø±Ø§ÛŒ performance
#    3. ØªÙ†Ø¸ÛŒÙ… pg_hba.conf Ø¨Ø±Ø§ÛŒ authentication
#    4. Ø³Ø§Ø®Øª database Ùˆ user
#    5. ØªÙ†Ø¸ÛŒÙ… backup Ø®ÙˆØ¯Ú©Ø§Ø±
#    6. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ SSL
#    7. ØªÙ†Ø¸ÛŒÙ… replication (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
#
# ğŸ“‹ Ù†Ø­ÙˆÙ‡ Ø§Ø¬Ø±Ø§:
#    ansible-playbook -i inventory.yml site.yml
#
# ğŸ·ï¸ Tags Ù…ÙˆØ¬ÙˆØ¯:
#    - install: ÙÙ‚Ø· Ù†ØµØ¨
#    - config: ÙÙ‚Ø· ØªÙ†Ø¸ÛŒÙ…Ø§Øª
#    - databases: Ø³Ø§Ø®Øª database Ùˆ user
#    - backup: ØªÙ†Ø¸ÛŒÙ… backup
#    - replication: ØªÙ†Ø¸ÛŒÙ… replication
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

---
all:
  children:
    postgres_primary:
      hosts:
        pg-primary:
          ansible_host: 192.168.1.50
          postgres_role: primary
    
    postgres_replica:
      hosts:
        pg-replica-1:
          ansible_host: 192.168.1.51
          postgres_role: replica
        pg-replica-2:
          ansible_host: 192.168.1.52
          postgres_role: replica
  
  vars:
    # PostgreSQL Version
    postgres_version: 16
    
    # Paths
    postgres_data_dir: /var/lib/postgresql/{{ postgres_version }}/main
    postgres_config_dir: /etc/postgresql/{{ postgres_version }}/main
    postgres_log_dir: /var/log/postgresql
    
    # Connection settings
    postgres_listen_addresses: "*"
    postgres_port: 5432
    postgres_max_connections: 200
    
    # Memory settings (ØªÙ†Ø¸ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ RAM Ø³Ø±ÙˆØ±)
    postgres_shared_buffers: "256MB"          # 25% of RAM
    postgres_effective_cache_size: "768MB"    # 75% of RAM
    postgres_work_mem: "4MB"
    postgres_maintenance_work_mem: "64MB"
    
    # WAL settings
    postgres_wal_level: replica
    postgres_max_wal_senders: 5
    postgres_wal_keep_size: "1GB"
    
    # Databases to create
    postgres_databases:
      - name: myapp
        owner: myapp
        encoding: UTF8
        lc_collate: en_US.UTF-8
        lc_ctype: en_US.UTF-8
      
      - name: analytics
        owner: analytics
        encoding: UTF8
    
    # Users to create
    postgres_users:
      - name: myapp
        password: "{{ vault_myapp_db_password }}"
        role_attr_flags: CREATEDB,NOSUPERUSER
      
      - name: analytics
        password: "{{ vault_analytics_db_password }}"
        role_attr_flags: NOSUPERUSER
      
      - name: readonly
        password: "{{ vault_readonly_db_password }}"
        role_attr_flags: NOSUPERUSER
    
    # Backup settings
    postgres_backup_enabled: true
    postgres_backup_dir: /var/backups/postgresql
    postgres_backup_retention_days: 7
    
    # Replication settings
    postgres_replication_enabled: true
    postgres_replication_user: replicator
    postgres_replication_password: "{{ vault_replication_password }}"
    
    # SSL
    postgres_ssl_enabled: true
