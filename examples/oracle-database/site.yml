# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¦ Oracle Database 19c Installation Playbook
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ¯ Ù‡Ø¯Ù:
#    Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Oracle Database 19c Ø±ÙˆÛŒ Oracle Linux ÛŒØ§ RHEL
#    Ø§ÛŒÙ† Playbook Ù…Ø±Ø§Ø­Ù„ Silent Installation Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
#
# âš ï¸ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§:
#    1. Ø¯Ø§Ù†Ù„ÙˆØ¯ Oracle Database Software Ø§Ø² Oracle.com
#    2. Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ÙØ§ÛŒÙ„ ZIP Ø¯Ø± /tmp/oracle_install/
#    3. Ø­Ø¯Ø§Ù‚Ù„ 8GB RAM Ùˆ 50GB Disk
#    4. Oracle Linux 7/8 ÛŒØ§ RHEL 7/8
#
# âœ… Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯:
#    1. Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ Ùˆ kernel parameters
#    2. Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Oracle
#    3. Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ Ùˆ ØªÙ†Ø¸ÛŒÙ… permissions
#    4. Ù†ØµØ¨ Oracle Database Ø¨Ø§ Response File
#    5. Ø³Ø§Ø®Øª Listener
#    6. Ø§ÛŒØ¬Ø§Ø¯ Container Database (CDB) Ùˆ Pluggable Database (PDB)
#    7. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³ Ø§Ø² Ù†ØµØ¨
#
# ğŸ“‹ Ù†Ø­ÙˆÙ‡ Ø§Ø¬Ø±Ø§:
#    ansible-playbook -i inventory.yml site.yml
#    ansible-playbook -i inventory.yml site.yml --tags prereq
#    ansible-playbook -i inventory.yml site.yml --tags install
#    ansible-playbook -i inventory.yml site.yml --tags createdb
#
# ğŸ“Š Tags Ù…ÙˆØ¬ÙˆØ¯:
#    - prereq: Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
#    - install: Ù†ØµØ¨ Oracle Software
#    - createdb: Ø§ÛŒØ¬Ø§Ø¯ Database
#    - listener: ØªÙ†Ø¸ÛŒÙ… Listener
#    - postinstall: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³ Ø§Ø² Ù†ØµØ¨
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

---
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- name: Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ÛŒ Oracle Database
  hosts: oracle_db
  become: yes
  tags: [prereq]
  
  tasks:
    #---------------------------------------------------------------------------
    # Ø¨Ø±Ø±Ø³ÛŒ Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„
    #---------------------------------------------------------------------------
    - name: Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„
      assert:
        that:
          - ansible_os_family == 'RedHat'
          - ansible_distribution_major_version | int >= 7
        fail_msg: "Ø§ÛŒÙ† Playbook ÙÙ‚Ø· Ø§Ø² Oracle Linux/RHEL 7/8 Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯"

    #---------------------------------------------------------------------------
    # Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²
    #---------------------------------------------------------------------------
    - name: Ù†ØµØ¨ Oracle preinstall package (Oracle Linux)
      yum:
        name: oracle-database-preinstall-19c
        state: present
      when: ansible_distribution == 'OracleLinux'

    - name: Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø² (RHEL)
      yum:
        name:
          - bc
          - binutils
          - compat-libcap1
          - compat-libstdc++-33
          - elfutils-libelf
          - elfutils-libelf-devel
          - fontconfig-devel
          - glibc
          - glibc-devel
          - ksh
          - libaio
          - libaio-devel
          - libX11
          - libXau
          - libXi
          - libXtst
          - libXrender
          - libXrender-devel
          - libgcc
          - libstdc++
          - libstdc++-devel
          - libxcb
          - make
          - net-tools
          - nfs-utils
          - python3
          - python3-configshell
          - python3-rtslib
          - smartmontools
          - sysstat
          - targetcli
          - unixODBC
        state: present
      when: ansible_distribution != 'OracleLinux'

    #---------------------------------------------------------------------------
    # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Kernel
    #---------------------------------------------------------------------------
    - name: ØªÙ†Ø¸ÛŒÙ… kernel parameters
      sysctl:
        name: "{{ item.name }}"
        value: "{{ item.value }}"
        state: present
        reload: yes
        sysctl_file: /etc/sysctl.d/98-oracle.conf
      loop:
        - { name: 'fs.file-max', value: '6815744' }
        - { name: 'kernel.sem', value: '250 32000 100 128' }
        - { name: 'kernel.shmmni', value: '4096' }
        - { name: 'kernel.shmall', value: '1073741824' }
        - { name: 'kernel.shmmax', value: '4398046511104' }
        - { name: 'kernel.panic_on_oops', value: '1' }
        - { name: 'net.core.rmem_default', value: '262144' }
        - { name: 'net.core.rmem_max', value: '4194304' }
        - { name: 'net.core.wmem_default', value: '262144' }
        - { name: 'net.core.wmem_max', value: '1048576' }
        - { name: 'net.ipv4.conf.all.rp_filter', value: '2' }
        - { name: 'net.ipv4.conf.default.rp_filter', value: '2' }
        - { name: 'fs.aio-max-nr', value: '1048576' }
        - { name: 'net.ipv4.ip_local_port_range', value: '9000 65500' }

    #---------------------------------------------------------------------------
    # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Limits
    #---------------------------------------------------------------------------
    - name: ØªÙ†Ø¸ÛŒÙ… ulimits Ø¨Ø±Ø§ÛŒ oracle user
      pam_limits:
        domain: oracle
        limit_type: "{{ item.type }}"
        limit_item: "{{ item.item }}"
        value: "{{ item.value }}"
      loop:
        - { type: soft, item: nofile, value: 1024 }
        - { type: hard, item: nofile, value: 65536 }
        - { type: soft, item: nproc, value: 16384 }
        - { type: hard, item: nproc, value: 16384 }
        - { type: soft, item: stack, value: 10240 }
        - { type: hard, item: stack, value: 32768 }
        - { type: soft, item: memlock, value: 134217728 }
        - { type: hard, item: memlock, value: 134217728 }

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Oracle
      group:
        name: "{{ item.name }}"
        gid: "{{ item.gid }}"
        state: present
      loop:
        - { name: 'oinstall', gid: 54321 }
        - { name: 'dba', gid: 54322 }
        - { name: 'oper', gid: 54323 }
        - { name: 'backupdba', gid: 54324 }
        - { name: 'dgdba', gid: 54325 }
        - { name: 'kmdba', gid: 54326 }
        - { name: 'racdba', gid: 54330 }

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø± Oracle
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø± oracle
      user:
        name: oracle
        uid: 54321
        group: oinstall
        groups: dba,oper,backupdba,dgdba,kmdba,racdba
        home: /home/oracle
        shell: /bin/bash
        password: "{{ 'oracle' | password_hash('sha512') }}"

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Oracle
      file:
        path: "{{ item }}"
        state: directory
        owner: oracle
        group: oinstall
        mode: '0775'
      loop:
        - "{{ oracle_base }}"
        - "{{ oracle_home }}"
        - "{{ oracle_inventory }}"
        - "{{ oracle_data_path }}"
        - "{{ oracle_fra_path }}"
        - "/tmp/oracle_install"

    #---------------------------------------------------------------------------
    # ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Firewall (ÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Rules)
    #---------------------------------------------------------------------------
    - name: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† firewall rules
      firewalld:
        port: "{{ item }}"
        permanent: yes
        state: enabled
      loop:
        - "{{ oracle_listener_port }}/tcp"
        - "{{ oracle_em_port }}/tcp"
      notify: reload firewall
      ignore_errors: yes

    #---------------------------------------------------------------------------
    # ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† SELinux (ÛŒØ§ ØªÙ†Ø¸ÛŒÙ… permissive)
    #---------------------------------------------------------------------------
    - name: ØªÙ†Ø¸ÛŒÙ… SELinux Ø¨Ù‡ permissive
      selinux:
        policy: targeted
        state: permissive
      ignore_errors: yes

    #---------------------------------------------------------------------------
    # ØªÙ†Ø¸ÛŒÙ… /etc/hosts
    #---------------------------------------------------------------------------
    - name: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† hostname Ø¨Ù‡ /etc/hosts
      lineinfile:
        path: /etc/hosts
        line: "{{ ansible_host }} {{ ansible_hostname }} {{ ansible_fqdn }}"
        state: present

  handlers:
    - name: reload firewall
      firewalld:
        state: reloaded


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù†ØµØ¨ Oracle Database Software
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- name: Ù†ØµØ¨ Oracle Database Software
  hosts: oracle_db
  become: yes
  become_user: oracle
  tags: [install]
  
  tasks:
    #---------------------------------------------------------------------------
    # ØªÙ†Ø¸ÛŒÙ… Environment Variables
    #---------------------------------------------------------------------------
    - name: ØªÙ†Ø¸ÛŒÙ… Oracle environment
      blockinfile:
        path: /home/oracle/.bash_profile
        block: |
          # Oracle Settings
          export ORACLE_BASE={{ oracle_base }}
          export ORACLE_HOME={{ oracle_home }}
          export ORACLE_SID={{ oracle_sid }}
          export PATH=$ORACLE_HOME/bin:$PATH
          export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
          export TNS_ADMIN=$ORACLE_HOME/network/admin
          export NLS_LANG=AMERICAN_AMERICA.{{ oracle_charset }}
        marker: "# {mark} ANSIBLE MANAGED ORACLE ENV"

    #---------------------------------------------------------------------------
    # Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙØ§ÛŒÙ„ Ù†ØµØ¨
    #---------------------------------------------------------------------------
    - name: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Oracle Database Software
      unarchive:
        src: /tmp/oracle_install/LINUX.X64_193000_db_home.zip
        dest: "{{ oracle_home }}"
        remote_src: yes
        creates: "{{ oracle_home }}/runInstaller"

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Response File
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Response File Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨
      template:
        src: templates/db_install.rsp.j2
        dest: /tmp/oracle_install/db_install.rsp
        owner: oracle
        group: oinstall
        mode: '0640'

    #---------------------------------------------------------------------------
    # Ù†ØµØ¨ Oracle Ø¨Ø§ Silent Mode
    #---------------------------------------------------------------------------
    - name: Ù†ØµØ¨ Oracle Database Software
      shell: |
        source /home/oracle/.bash_profile
        {{ oracle_home }}/runInstaller -silent -waitforcompletion \
          -responseFile /tmp/oracle_install/db_install.rsp
      args:
        creates: "{{ oracle_home }}/bin/sqlplus"
      register: oracle_install
      failed_when: 
        - oracle_install.rc not in [0, 6]

    #---------------------------------------------------------------------------
    # Ø§Ø¬Ø±Ø§ÛŒ root scripts
    #---------------------------------------------------------------------------
    - name: Ø§Ø¬Ø±Ø§ÛŒ orainstRoot.sh
      shell: "{{ oracle_inventory }}/orainstRoot.sh"
      become: yes
      become_user: root

    - name: Ø§Ø¬Ø±Ø§ÛŒ root.sh
      shell: "{{ oracle_home }}/root.sh"
      become: yes
      become_user: root


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø³Ø§Ø®Øª Listener
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- name: Ø³Ø§Ø®Øª Ùˆ Ú©Ø§Ù†ÙÛŒÚ¯ Listener
  hosts: oracle_db
  become: yes
  become_user: oracle
  tags: [listener]
  
  tasks:
    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Response File Ø¨Ø±Ø§ÛŒ Listener
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª netca response file
      template:
        src: templates/netca.rsp.j2
        dest: /tmp/oracle_install/netca.rsp
        owner: oracle
        group: oinstall
        mode: '0640'

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Listener
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Listener Ø¨Ø§ netca
      shell: |
        source /home/oracle/.bash_profile
        {{ oracle_home }}/bin/netca -silent -responseFile /tmp/oracle_install/netca.rsp
      args:
        creates: "{{ oracle_home }}/network/admin/listener.ora"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§ÛŒØ¬Ø§Ø¯ Database
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- name: Ø§ÛŒØ¬Ø§Ø¯ Oracle Database
  hosts: oracle_primary
  become: yes
  become_user: oracle
  tags: [createdb]
  
  tasks:
    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Response File Ø¨Ø±Ø§ÛŒ DBCA
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª dbca response file
      template:
        src: templates/dbca.rsp.j2
        dest: /tmp/oracle_install/dbca.rsp
        owner: oracle
        group: oinstall
        mode: '0640'

    #---------------------------------------------------------------------------
    # Ø§ÛŒØ¬Ø§Ø¯ Database
    #---------------------------------------------------------------------------
    - name: Ø§ÛŒØ¬Ø§Ø¯ Database Ø¨Ø§ DBCA
      shell: |
        source /home/oracle/.bash_profile
        {{ oracle_home }}/bin/dbca -silent -createDatabase \
          -responseFile /tmp/oracle_install/dbca.rsp
      args:
        creates: "{{ oracle_data_path }}/{{ oracle_sid | upper }}/system01.dbf"
      register: dbca_output
      async: 3600  # ÛŒÚ© Ø³Ø§Ø¹Øª timeout
      poll: 60

    #---------------------------------------------------------------------------
    # ØªÙ†Ø¸ÛŒÙ… Auto Start
    #---------------------------------------------------------------------------
    - name: ØªÙ†Ø¸ÛŒÙ… Oracle Ø¨Ø±Ø§ÛŒ Auto Start
      lineinfile:
        path: /etc/oratab
        regexp: "^{{ oracle_sid }}:"
        line: "{{ oracle_sid }}:{{ oracle_home }}:Y"
      become: yes
      become_user: root


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³ Ø§Ø² Ù†ØµØ¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- name: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³ Ø§Ø² Ù†ØµØ¨
  hosts: oracle_db
  become: yes
  tags: [postinstall]
  
  tasks:
    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Systemd Service
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Oracle systemd service
      template:
        src: templates/oracle.service.j2
        dest: /etc/systemd/system/oracle.service
        owner: root
        group: root
        mode: '0644'
      notify: enable oracle service

    #---------------------------------------------------------------------------
    # Ø³Ø§Ø®Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
    #---------------------------------------------------------------------------
    - name: Ø³Ø§Ø®Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øª start_oracle.sh
      copy:
        dest: /home/oracle/scripts/start_oracle.sh
        content: |
          #!/bin/bash
          source /home/oracle/.bash_profile
          
          echo "Starting Oracle Listener..."
          lsnrctl start
          
          echo "Starting Oracle Database..."
          sqlplus / as sysdba <<EOF
          startup
          alter pluggable database all open;
          exit
          EOF
          
          echo "Oracle Database started successfully."
        owner: oracle
        group: oinstall
        mode: '0755'

    - name: Ø³Ø§Ø®Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øª stop_oracle.sh
      copy:
        dest: /home/oracle/scripts/stop_oracle.sh
        content: |
          #!/bin/bash
          source /home/oracle/.bash_profile
          
          echo "Stopping Oracle Database..."
          sqlplus / as sysdba <<EOF
          shutdown immediate
          exit
          EOF
          
          echo "Stopping Oracle Listener..."
          lsnrctl stop
          
          echo "Oracle Database stopped successfully."
        owner: oracle
        group: oinstall
        mode: '0755'

    #---------------------------------------------------------------------------
    # Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ
    #---------------------------------------------------------------------------
    - name: Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªØ±Ø³ÛŒ
      debug:
        msg: |
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          âœ… Oracle Database Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯!
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ—„ï¸ Database SID: {{ oracle_sid }}
          ğŸ“¦ PDB Name: {{ oracle_pdb_name }}
          
          ğŸ”Œ Connection String:
             - CDB: {{ ansible_host }}:{{ oracle_listener_port }}/{{ oracle_sid }}
             - PDB: {{ ansible_host }}:{{ oracle_listener_port }}/{{ oracle_pdb_name }}
          
          ğŸ” Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:
             - SYS (as SYSDBA)
             - SYSTEM
             - PDBADMIN (Ø¯Ø± PDB)
          
          ğŸ“Š Enterprise Manager:
             https://{{ ansible_host }}:{{ oracle_em_port }}/em
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  handlers:
    - name: enable oracle service
      systemd:
        name: oracle
        enabled: yes
        daemon_reload: yes
